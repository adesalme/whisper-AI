<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />
    <title>{{ title }}</title>
    <style>
      :root {
        color-scheme: light dark;
      }
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu,
          Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji",
          "Segoe UI Emoji";
        margin: 2rem auto;
        max-width: 900px;
        padding: 0 1rem;
      }
      h1 {
        margin-bottom: 0.25rem;
      }
      .meta {
        color: #888;
        margin-bottom: 2rem;
      }
      .card {
        border: 1px solid #4443;
        border-radius: 12px;
        padding: 1rem;
      }
      .row {
        display: flex;
        gap: 1rem;
        align-items: center;
        flex-wrap: wrap;
      }
      label {
        font-weight: 600;
      }
      input[type="file"] {
        padding: 0.5rem;
      }
      select,
      button {
        padding: 0.6rem 0.9rem;
        border-radius: 8px;
        border: 1px solid #4443;
        cursor: pointer;
      }
      button {
        background: #4f46e5;
        color: white;
        border: none;
      }
      button[disabled] {
        background: #888;
        cursor: wait;
      }
      pre {
        white-space: pre-wrap;
        word-wrap: break-word;
        background: #0000000a;
        padding: 1rem;
        border-radius: 8px;
      }
      footer {
        margin-top: 2rem;
        color: #888;
        font-size: 0.9rem;
      }
    </style>
  </head>
  <body>
    <h1>Transcription audio</h1>
    <div class="meta">
      Modèle: <strong>{{ model }}</strong> • Appareil:
      <strong>{{ device }}</strong>
    </div>

    <div class="card">
      <form id="form" class="row">
        <div class="row">
          <label for="file">Fichier audio (mp3, wav, m4a...)</label>
          <input id="file" name="file" type="file" accept="audio/*" required />
        </div>
        <div class="row">
          <label for="language">Langue (optionnel)</label>
          <select id="language" name="language">
            <option value="">Auto</option>
            <option value="fr">Français</option>
            <option value="en">English</option>
            <option value="es">Español</option>
            <option value="de">Deutsch</option>
            <option value="it">Italiano</option>
            <option value="pt">Português</option>
            <option value="ar">العربية</option>
            <option value="zh">中文</option>
            <option value="ja">日本語</option>
          </select>
        </div>
        <div>
          <button id="submit" type="submit">Transcrire</button>
        </div>
      </form>
    </div>

    <h3>Résultat</h3>
    <pre id="output">Aucun résultat pour le moment.</pre>

    <footer>
      Cette application utilise Whisper <strong>large-v3</strong>. Pour de
      meilleures performances, utilisez un GPU (CUDA).
    </footer>

    <script>
      const form = document.getElementById("form");
      const output = document.getElementById("output");
      const submitBtn = document.getElementById("submit");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const fileInput = document.getElementById("file");
        if (!fileInput.files.length) return;
        const language = document.getElementById("language").value;

        const data = new FormData();
        data.append("file", fileInput.files[0]);
        if (language) data.append("language", language);

        output.textContent = "Transcription en cours...";
        submitBtn.disabled = true;

        try {
          const res = await fetch("/transcribe", {
            method: "POST",
            body: data,
          });
          const json = await res.json();
          if (!res.ok) throw new Error(json.error || "Erreur de transcription");
          output.textContent = json.text || "";
        } catch (err) {
          output.textContent = "Erreur: " + err.message;
        } finally {
          submitBtn.disabled = false;
        }
      });
    </script>
  </body>
</html>
